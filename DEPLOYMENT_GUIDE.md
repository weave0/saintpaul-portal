# St. Paul Historical Knowledge Portal - Deployment Guide

## Quick Deploy Options

### Option 1: Azure Static Web Apps (Recommended)

#### Prerequisites
```powershell
# Install Azure CLI
winget install Microsoft.AzureCLI

# Login to Azure
az login

# Install Static Web Apps CLI (for local testing)
npm install -g @azure/static-web-apps-cli
```

#### Deploy to Azure
```powershell
# 1. Create a resource group
az group create --name stpaul-history-rg --location centralus

# 2. Create a Static Web App
az staticwebapp create `
  --name stpaul-history-portal `
  --resource-group stpaul-history-rg `
  --source https://github.com/Weave0/SaintPaul `
  --location centralus `
  --branch main `
  --app-location "/frontend" `
  --api-location "/backend" `
  --output-location "dist"

# 3. Configure environment variables
az staticwebapp appsettings set `
  --name stpaul-history-portal `
  --resource-group stpaul-history-rg `
  --setting-names MONGODB_URI="<your-connection-string>"
```

#### Set up GitHub Actions (Automatic)
Azure will automatically create a GitHub Actions workflow in `.github/workflows/`

### Option 2: Vercel (Fastest MVP)

#### Prerequisites
```powershell
# Install Vercel CLI
npm install -g vercel
```

#### Deploy to Vercel
```powershell
# Login to Vercel
vercel login

# Deploy (first time - will ask questions)
vercel

# Production deployment
vercel --prod
```

#### Configure Environment Variables
```powershell
# Add MongoDB connection string
vercel env add MONGODB_URI production

# Add other secrets
vercel env add NODE_ENV production
```

### Option 3: Manual Azure App Service + Static Site

#### Backend (App Service)
```powershell
# Create App Service plan
az appservice plan create `
  --name stpaul-api-plan `
  --resource-group stpaul-history-rg `
  --sku B1 `
  --is-linux

# Create web app
az webapp create `
  --resource-group stpaul-history-rg `
  --plan stpaul-api-plan `
  --name stpaul-history-api `
  --runtime "NODE|18-lts"

# Deploy backend
cd backend
az webapp up `
  --name stpaul-history-api `
  --resource-group stpaul-history-rg
```

#### Frontend (Storage Static Website)
```powershell
# Create storage account
az storage account create `
  --name stpaulhistory `
  --resource-group stpaul-history-rg `
  --location centralus `
  --sku Standard_LRS

# Enable static website
az storage blob service-properties update `
  --account-name stpaulhistory `
  --static-website `
  --index-document index.html `
  --404-document index.html

# Build frontend
cd frontend
npm run build

# Upload to Azure
az storage blob upload-batch `
  --account-name stpaulhistory `
  --source ./dist `
  --destination '$web'
```

## Database Setup

### MongoDB Atlas (Cloud Database)

```powershell
# 1. Sign up at https://www.mongodb.com/cloud/atlas
# 2. Create a free cluster
# 3. Get connection string
# 4. Whitelist IP addresses (or allow all: 0.0.0.0/0)
```

Connection string format:
```
mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/stpaul-history?retryWrites=true&w=majority
```

### Azure Cosmos DB (MongoDB API)

```powershell
# Create Cosmos DB account
az cosmosdb create `
  --name stpaul-history-db `
  --resource-group stpaul-history-rg `
  --kind MongoDB `
  --server-version 4.2 `
  --default-consistency-level Session

# Get connection string
az cosmosdb keys list `
  --name stpaul-history-db `
  --resource-group stpaul-history-rg `
  --type connection-strings
```

## GitHub Repository Setup

### Create Remote Repository

```powershell
# Using GitHub CLI
gh repo create SaintPaul --public --source=. --remote=origin --push

# Or manually:
# 1. Go to https://github.com/new
# 2. Create repository named "SaintPaul"
# 3. Push local repo:
git remote add origin https://github.com/Weave0/SaintPaul.git
git branch -M main
git push -u origin main
```

### Enable GitHub Actions
The workflow file will be auto-generated by Azure Static Web Apps, or create manually:

`.github/workflows/azure-static-web-apps.yml`

## Environment Variables

### Required Variables
```
MONGODB_URI=<your-mongodb-connection-string>
NODE_ENV=production
PORT=3000
```

### Optional Variables
```
MAPBOX_ACCESS_TOKEN=<for-maps>
AZURE_STORAGE_CONNECTION_STRING=<for-images>
OPENAI_API_KEY=<for-ai-features>
```

## Custom Domain Setup

### Purchase Domain (Suggestions)
- stpaulhistory.org
- stpaulknowledge.org
- historicstpaul.org
- saintpaularchive.org

### Configure DNS (Azure)
```powershell
# Add custom domain
az staticwebapp hostname set `
  --name stpaul-history-portal `
  --resource-group stpaul-history-rg `
  --hostname stpaulhistory.org
```

Then update DNS records at your registrar:
```
CNAME @ <your-app>.azurestaticapps.net
```

### SSL Certificate
Azure Static Web Apps provides free SSL certificates automatically.

## Local Development

```powershell
# Install dependencies
cd backend
npm install

cd ../frontend
npm install

# Set up environment variables
# Create backend/.env:
echo "MONGODB_URI=mongodb://localhost:27017/stpaul-history" > backend/.env
echo "PORT=3000" >> backend/.env

# Start backend
cd backend
npm run dev

# Start frontend (in new terminal)
cd frontend
npm run dev
```

## Testing Deployment

### Health Check Endpoints
```
GET https://<your-app>.azurestaticapps.net/api/health
GET https://<your-app>.azurestaticapps.net/
```

### Load Test
```powershell
# Using Apache Bench
ab -n 1000 -c 10 https://<your-app>.azurestaticapps.net/
```

## Monitoring & Analytics

### Azure Application Insights
```powershell
# Create Application Insights
az monitor app-insights component create `
  --app stpaul-history-insights `
  --location centralus `
  --resource-group stpaul-history-rg `
  --application-type web

# Get instrumentation key
az monitor app-insights component show `
  --app stpaul-history-insights `
  --resource-group stpaul-history-rg `
  --query instrumentationKey
```

### Google Analytics
Add to `frontend/index.html`:
```html
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
```

## Scaling & Performance

### Azure Static Web Apps
- **Free Tier**: 100 GB bandwidth/month, custom domains, SSL
- **Standard Tier**: Unlimited bandwidth, SLA, more build minutes

### CDN Configuration
Already included with Azure Static Web Apps - global distribution automatic.

## Security Checklist

- [ ] Environment variables secured (not in Git)
- [ ] HTTPS enforced
- [ ] CORS configured properly
- [ ] API rate limiting enabled
- [ ] Database authentication required
- [ ] Input validation on all endpoints
- [ ] XSS protection headers
- [ ] Regular dependency updates

## Backup Strategy

### Database Backups
```powershell
# MongoDB Atlas: Automatic continuous backups
# Cosmos DB: Configure backup policy
az cosmosdb backup-policy show `
  --resource-group stpaul-history-rg `
  --account-name stpaul-history-db
```

### Code Backups
- Git repository (GitHub)
- Multiple branches for staging/production
- Tagged releases

## Cost Estimates (Monthly)

### Azure (Small Scale)
- Static Web Apps: $0-9 (Free tier sufficient initially)
- Cosmos DB: $25-100 (depends on throughput)
- Storage: $1-5
- **Total: ~$26-114/month**

### Vercel + MongoDB Atlas
- Vercel: $0-20 (Free tier for hobby projects)
- MongoDB Atlas: $0-57 (Free tier M0 cluster available)
- **Total: ~$0-77/month**

### Recommended Start: Free Tier
- Vercel Free
- MongoDB Atlas Free (M0)
- **Total: $0/month**

Then scale as traffic grows.

## Next Steps

1. Choose deployment platform (Vercel for quick start, Azure for enterprise)
2. Set up database (MongoDB Atlas free tier recommended)
3. Configure environment variables
4. Push to GitHub
5. Deploy!
6. Share with St. Paul community

## Support & Resources

- Azure Documentation: https://docs.microsoft.com/azure
- Vercel Documentation: https://vercel.com/docs
- MongoDB Atlas: https://docs.atlas.mongodb.com

---

**Ready to deploy your St. Paul history to the world! üé®üèõÔ∏è**
